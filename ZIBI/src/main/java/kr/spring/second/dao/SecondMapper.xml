<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.spring.second.dao.SecondMapper">
	<!-- 중고거래 글 등록 -->
	<insert id="insertSecond" parameterType="secondVO">
		INSERT INTO second(
			sc_num,
			sc_title,
			sc_category,
			sc_price,
			sc_content,
			sc_status,
			sc_way,
			sc_filename,
			sc_ip,
			mem_num)
		VALUES (
			second_seq.nextval,
			#{sc_title},
			#{sc_category},
			#{sc_price},
			#{sc_content},
			#{sc_status},
			#{sc_way},
			#{sc_filename,jdbcType=VARCHAR},
			#{sc_ip},
			#{mem_num})
	</insert>
	
	<!-- sql 태그와 include 태그를 이용해 SQL문 재사용 -->
	<sql id="secondSearch">
		<where>
			<if test="keyword != null and keyword != ''">
					title LIKE '%' || #{keyword} || '%' OR
					content LIKE '%' || #{keyword} || '%'
			</if>		
		</where>
	</sql>
	
	<!-- 중고거래 글의 총개수/검색 개수 -->
	<select id="selectRowCount" parameterType="map" resultType="integer">
		SELECT COUNT(*) FROM second JOIN member USING(mem_num)
		<include refid="secondSearch"></include>
	</select>
	
	<!-- 중고거래 전체 목록/검색 목록 -->
	<select id="selectList" parameterType="map" resultType="secondVO">
		SELECT * FROM (SELECT a.*, rownum rnum FROM 
		(SELECT 
			sc_num,
			sc_title,sc_price,sc_filename,
			sc_reg_date, mem_num
		FROM second
		JOIN member USING(mem_num))a) 
		<include refid="secondSearch"></include>
		<![CDATA[
		WHERE rnum >= #{start} AND rnum <= #{end}
		]]>
	</select>
</mapper>
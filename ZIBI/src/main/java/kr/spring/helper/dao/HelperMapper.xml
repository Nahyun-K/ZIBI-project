<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.spring.helper.dao.HelperMapper">
	<!-- 재능기부 글 등록 -->
	<insert id="insertHelper" parameterType="helperVO">
		INSERT INTO helper(
			helper_num,
			helper_title,
			helper_content,
			helper_filename,
			helper_zipcode,
			helper_address1,
			helper_address2,
			helper_reg_date
		VALUES(
			helper_seq.nextval,
			#{helper_title},
			#{helper_content},
			#{helper_filename,jdbcType=VARCHAR},
			#{helper_zipcode},
			#{helper_address1},
			#{helper_address2},
			#{helper_reg_date})
	</insert>
	
	<!-- include할 sql태그 -->
	<sql id="helperSearch">
		<where>
			<if test="keyword != null and keyword !=''">
				<if test="keyfield == 1">
					helper_title LIKE '%' || #{keyword} || '%'
				</if>
				<if test="keyfield == 2">
					helper_content LIKE '%' || #{keyword} || '%'
				</if>
				<if test="keyfield == 3">
					helper_address1 LIKE '%' || #{keyword} || '%'
				</if>
				<if test="keyfield == 3">
					helper_title LIKE '%' || #{keyword} || '%' OR
					helper_content LIKE '%' || #{keyword} || '%'
				</if>
			</if> 
		</where>
	</sql>
	
	<!-- 정렬 -->
	<sql id="helperOrder">
		<if test="order == 1">
			ORDER BY rental_num DESC
		</if>
		<if test="order == 2">
			ORDER BY rental_hit DESC
		</if>
	</sql>
	
	
	<!-- 게시판 글의 총 개수/검색 개수 -->
	<select id="selectRowCount" parameterType="map" resultType="integer">
		SELECT
			COUNT(*)
		FROM helper JOIN member USING(mem_num)
		<include refid="helperSearch"></include>
	</select>
	
	<!-- 게시판 전체 목록/검색 목록 -->
	<select id="selectList" parameterType="map" resultType="helperVO">
		SELECT
		  *
		FROM (SELECT
				a.*,
			  	rownum rnum
			  FROM (SELECT
			  			rental_num,
			  			<![CDATA[
			  		 	REPLACE(REPLACE(title,'<','&lt;'),'>','&gt;') helper_title,
			  			]]>
			  			helper_hit,
			  			helper_address1,
			  			helper_reg_date,
			  			mem_num
			  		FROM helper
			  		JOIN member USING(mem_num)
			  		<include refid="helperSearch"></include>
			  		<include refid="helperOrder"></include>)a)
		  <![CDATA[
		  WHERE rnum >= #{start} AND rnum <= #{end}
	      ]]>			
	</select>
</mapper>























